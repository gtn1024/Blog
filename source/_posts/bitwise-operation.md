---
title: 你一定看得懂的位运算
date: 2021-09-03 10:56:39
categories:
- 知识科普
tags:
- 位运算
---

**位运算**是直接对整数在内存中的二进制位进行操作。

<!-- more -->

阅读本章时，可以打开计算机上的计算器，并将其设置为**程序员模式**。

{% asset_img 16306388392067.jpg %}

## 了解位

在计算机内部，数据以**二进制**来存储，每一个**二进制数**称为一个**位**(**Bit**)。

## 位运算

**位运算**通常有如下几个操作：

- 位与(&, and)，当两位同时为 1 时才返回 1。
- 位或(|, or)，只要有一位为 1 就返回 1。
- 异或(^, xor)，当两位相同时返回 0，不相同时返回 1。
- 位非(~, not)，将操作数的每个位（包括**符号位**）全部取反。
- 左移(<<, lsh)
- 右移(>>, rsh)

其中，Java 语言还多一个**无符号右移**(>>>)。

**位与**、**位或**、**异或**的运算法则如下：

|          |     |     |     |     |
| -------- | --- | --- | --- | --- |
| 操作数 1 | 0   | 0   | 1   | 1   |
| 操作数 2 | 0   | 1   | 0   | 1   |
| 位与     | 0   | 0   | 0   | 1   |
| 位或     | 0   | 1   | 1   | 1   |
| 异或     | 0   | 1   | 1   | 0   |

### 位与

举个例子，`5 & 9 = 1`，为什么呢？

首先将这两个数转换成二进制

```text
5: 0000 0000 0000 0000 0000 0000 0000 0101
9: 0000 0000 0000 0000 0000 0000 0000 1001
------------------------------------------
&: 0000 0000 0000 0000 0000 0000 0000 0001 = 1
```

### 位或

`5 | 9 = 13`

```text
5: 0000 0000 0000 0000 0000 0000 0000 0101
9: 0000 0000 0000 0000 0000 0000 0000 1001
------------------------------------------
|: 0000 0000 0000 0000 0000 0000 0000 1101 = 13
```

### 异或

`5 ^ 9 = 12`

```text
5: 0000 0000 0000 0000 0000 0000 0000 0101
9: 0000 0000 0000 0000 0000 0000 0000 1001
------------------------------------------
^: 0000 0000 0000 0000 0000 0000 0000 1100 = 12
```

### 位非

`~-5 = 4`

```text
 -5: 1111 1111 1111 1111 1111 1111 1111 1011 (计算机内部负数以补码形式表示)
~-5: 0000 0000 0000 0000 0000 0000 0000 0100
```

### 左移

**左移**是将操作数二进制码整体向左移动制定的位数，左移后右边空出来的地方用 `0` 来填充。

`5<<2 = 20`，`-5<<2 = -20`

```text
      5:    0000 0000 0000 0000 0000 0000 0000 0101
   5<<2: 00 0000 0000 0000 0000 0000 0000 0001 0100
->          0000 0000 0000 0000 0000 0000 0001 0100 = 20
--------------------------------------------------------
     -5:    1111 1111 1111 1111 1111 1111 1111 1011
  -5<<2: 11 1111 1111 1111 1111 1111 1111 1110 1100
->          1111 1111 1111 1111 1111 1111 1110 1100 = -20
```

### 右移

**右移**是将操作数的二进制码向右移动指定位数，右移后左边空出来的地方以原来的符号为来填充。若原来为正数，则在左边补 0，若为负数，则补 1。

`5>>2 = 1`，`-5>>2 = -2`

```text
     5: 0000 0000 0000 0000 0000 0000 0000 0101
  5>>2:   00 0000 0000 0000 0000 0000 0000 0001 01
->      0000 0000 0000 0000 0000 0000 0000 0001    = 1
------------------------------------------------------
    -5: 1111 1111 1111 1111 1111 1111 1111 1011
 -5>>2:   11 1111 1111 1111 1111 1111 1111 1110 11
->      1111 1111 1111 1111 1111 1111 1111 1110    = -2
```

### Java 中的无符号右移

与**右移**不同，**无符号右移**无论操作数为正数还是负数都将在左侧补 0。

`-5>>>2 = 1073741822`

```text
     -5: 1111 1111 1111 1111 1111 1111 1111 1011
 -5>>>2:   11 1111 1111 1111 1111 1111 1111 1110 11
->       0011 1111 1111 1111 1111 1111 1111 1110    = 1073741822
```

## 参考资料

- [疯狂 Java 讲义](https://union-click.jd.com/jdc?e=&p=JF8BAM4JK1olXgALUV9YC04TAl8IGVodXAULV24ZVxNJXF9RXh5UHw0cSgYYXBcIWDoXSQVJQwYAVVZcC0IUHDZNRwYlOVsHFhoOYSJ0BBl1QQ9VGl90CDVZeEcbM244G1oUXgMAUlpUD3snA2g4TTUVXAcDVV9YCE4UM244G1wXXAEGXVxaDk8SBl8PG1IlBlNsIjUeSzBSVxBWfQZ1bTYyV25tOEsnAF9KdQkdVFIAUwsICh8RVmpdHV9FDwNXXApVCEhFBm4IHg4VbQQDVVpUOA)
